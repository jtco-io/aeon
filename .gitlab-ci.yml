variables:
  DOCKER_DRIVER: overlay2

stages:
  - test_whitebox

test_whitebox:
  stage: test_whitebox
  image: node:carbon
  cache:
    paths:
    - node_modules/
    - server/node_modules/
    - client/node_modules/
  before_script:
    - yarn install
    - cd ./client && yarn install
    - cd ../server && yarn install
    - cd ../
    - yarn run lint
    - yarn run build
    # Run command in background to allow CI to stat server and keep running commands
    # https://documentation.codeship.com/basic/continuous-integration/run-a-command-in-the-background/
    - nohup bash -c 'yarn run server:prod:start 2>&1 &'
  script:
    - curl http://localhost:8080
  after_script:
    - echo 'Prion brought to you by JTCO and JTX'
    - echo 'To see more check out jtco.io and jtronics.exchange'
